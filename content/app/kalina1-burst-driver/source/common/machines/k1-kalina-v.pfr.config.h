#if (!defined(k1_prf_config_hpp)) && defined(k1_burst_common_h)
#define k1_prf_config_hpp
#else
#error error of using k1-kiparis2.prf.config.hpp
#endif

#define K1_CPU_FREQ_HZ 168000000LL
#define K1_ADC_CURRENT_SENCE_TIME_US 3


#define FMSTR_REC_TIMEBASE (32768+K1_CONTROL_PERIOD_US)
#define FMSTR_REC_BUFF_SIZE 4000

#define motor_INV3PH_NATIVE_RANGE_LO						0
#define motor_INV3PH_NATIVE_RANGE_HI						(K1_PWM_MODULO-K1_ADC_DELAY)
#define motor_INV3PH_PWM_FORCE	1300
//900

#define motor_RANGE_VOLTAGE_LO									BURST_SIGNAL_MIN
#define motor_RANGE_VOLTAGE_HI									BURST_SIGNAL_MAX
#define motor_LATERAL_VOLTAGE_RANGE_LO					BURST_SIGNAL_MIN
#define motor_LATERAL_VOLTAGE_RANGE_HI					BURST_SIGNAL_MAX
#define BURST_ADC_CHANNEL_COUNT 3
#define adc_INDEX {0,1,2}
#define adc_SCALE {1,1,1}

#define swt_CONFIG_PWM_MIN 84
//((K1_PWM_MODULO*1300)>>15)
#define swt_CONFIG_PWM_MAX motor_INV3PH_NATIVE_RANGE_HI
#define swt_CONFIG_SECTOR_OFFSET 0

#define BURST_PANICS_BOARD_RESET_TIMEOUT_PP 0
#define K1_BOARD_SERIAL_TYPE K1_SERIAL_TYPE_NONE

#if 0
#define motor_CURRENT3PH_DEFORM  	{\
     	26124, -55714 ,-28673, \
     	-56212, 63589, -19930, \
     	30088, -7875, 48603\
}
#endif

#if 0
#define motor_CURRENT3PH_DEFORM  	{\
     	65538, 0 ,0, \
     	0, 65538, 0, \
     	0, 0, 65538\
}
#endif

#define BURST_PROTECTION_ENABLED 1

#define BURST_PANICS_MASTER_LOST_ENABLED 0
#if BURST_PANICS_MASTER_LOST_ENABLED == 1
#define motor_REF_ALIVE_PERIOD_US 100000
#endif
		
#define BURST_PANICS_BOARD_TEMPER_ENABLED 1
#if BURST_PANICS_BOARD_TEMPER_ENABLED == 1
#define BURST_PANICS_BOARD_TEMPER_OVERHI_PP 70
#define BURST_PANICS_BOARD_TEMPER_HI_PP 60
#define BURST_PANICS_BOARD_TEMPER_LO_PP (-15)
#define BURST_PANICS_BOARD_TEMPER_ULTRALO_PP (-20)
#endif
		



#define K1_MOTOR_CURRENT_A_TO_PP_GAIN_15 ((burst_long_signal_t)(32767.*4.5032))
#define K1_MOTOR_CURRENT_PP_TO_A_GAIN_15 ((burst_long_signal_t)(32767.*0.2219))

#define K1_BOARD_COMMON_VER 2

//#define K1_BOARD_SERIAL_1_ENABLED 1
//#define K1_BOARD_SERIAL_2_ENABLED 1
//#define K1_BOARD_SERIAL_3_ENABLED 1
//#define K1_BOARD_NET_FLOW_ENABLED 1
#define K1_FREEMASTER_TYPE K1_FREEMASTER_TYPE_OV_FLOW_PROTO

#define BOARD_TEMPER_SENCE_ABC_ENABLED 1
#define BOARD_TEMPER_SENCE_MK_ENABLED 1

#define temper_ABC_FROM_PP_COUNT  62
#define temper_ABC_FROM_PP_GAIN_16  \
10515 ,7710 ,5832 ,4676 ,3974 ,3550 ,3202 ,2842 ,2755 ,2433 ,2415 ,2203 ,2158 ,2072 ,1968 ,1968\
,1852 ,1833 ,1827 ,1742 ,1742 ,1736 ,1691 ,1691 ,1689 ,1673 ,1673 ,1673 ,1689 ,1689 ,1689 ,1735\
,1735 ,1739 ,1812 ,1812 ,1837 ,1921 ,1921 ,2002 ,2065 ,2079 ,2244 ,2244 ,2420 ,2464 ,2654 ,2728\
,2994 ,3102 ,3411 ,3697 ,4008 ,4431 ,4996 ,5737 ,6694 ,7966 ,10042 ,13475 ,20008 ,25260

#define temper_ABC_FROM_PP_OFFSET  \
433 ,543 ,657 ,756 ,833 ,886 ,934 ,987 ,1000 ,1048 ,1050 ,1078 ,1083 ,1090 ,1097 ,1097\
 ,1098 ,1097 ,1097 ,1088 ,1088 ,1087 ,1077 ,1077 ,1076 ,1070 ,1070 ,1071 ,1078 ,1078 ,1078 ,1104\
 ,1104 ,1106 ,1152 ,1152 ,1168 ,1224 ,1224 ,1277 ,1319 ,1328 ,1433 ,1433 ,1538 ,1563 ,1667 ,1705\
 ,1832 ,1880 ,2005 ,2107 ,2207 ,2326 ,2461 ,2606 ,2755 ,2908 ,3087 ,3279 ,3483 ,3584
 
 #define temper_ABC_FROM_PP_ZERO 0
 #define temper_ABC_FROM_PP_SCALE_BITS 6
 
 
#define temper_MK_FROM_PP_COUNT  1
//T =(Vsence-V25)/Avg_Slope +25 = (Vsence-V25 + 25*Avg_Slope)/Avg_Slope
// = (3.3/4096*Nsence - V25 + 25*Avg_Slope)/Avg_Slope
// = 3.3/4096/Avg_Slope * (Nsence - V25*4096/3.3 + 25*Avg_Slope*4096/3.3 )
#define Avg_Slope  0.0025  
#define V25  0.76  

#define temper_MK_FROM_PP_GAIN_16  ((burst_signal_t)(3.3/4096./Avg_Slope*65536.))
#define temper_MK_FROM_PP_OFFSET  ((burst_signal_t)( V25*4096./3.3 -25*Avg_Slope*4096./3.3))
 
//напряжение питания
#define BOARD_VOLTAGE_SENCE_ENABLED 1
#if BOARD_VOLTAGE_SENCE_ENABLED
#define K1_BOARD_VOLTAGE_PP_TO_CVOLT_GAIN_10 ((burst_long_signal_t)( 2.4180 * 1024))
#define K1_BOARD_VOLTAGE_PP_TO_CVOLT_OFFSET_10 ((burst_long_signal_t)( -41.9731* 1024))
#define K1_BOARD_VOLTAGE_CVOLT_TO_PP_GAIN_10 ((burst_long_signal_t)( 0.4135 * 1024))
#define K1_BOARD_VOLTAGE_CVOLT_TO_PP_OFFSET_10 ((burst_long_signal_t)( 17.5190* 1024))

#define BURST_PANICS_BOARD_VOLTAGE_ENABLED 1
#if BURST_PANICS_BOARD_VOLTAGE_ENABLED == 1
#define BURST_PANICS_BOARD_VOLTAGE_OVERHI_PP 65
#define BURST_PANICS_BOARD_VOLTAGE_HI_PP 60
#define BURST_PANICS_BOARD_VOLTAGE_LO_PP 24
#define BURST_PANICS_BOARD_VOLTAGE_ULTRALO_PP 15
#endif

#endif

#define motor_INV3PH_DEFORM_ENABLED burst_true
#define motor_INV3PH_DEFORM_LEVEL 72
#define motor_INV3PH_DEFORM_HI_GAIN_16 1317595
#define motor_INV3PH_DEFORM_LO_GAIN_16 62679
#define motor_INV3PH_DEFORM_LO_BEVEL_16 93627631


